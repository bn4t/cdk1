<html>
<head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="module">
        import { CSV } from 'https://cdn.jsdelivr.net/npm/@vanillaes/csv@3.0.1/+esm';

        let pluvial = [];

        fetch('data/truncated.csv')
            .then(response => response.text())
            .then(data => {
                pluvial = CSV.parse(data);
            });

        // Load the Visualization API and the geochart package.
        google.charts.load('current', {'packages': ['geochart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the geo chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create the data table.
            var data = new google.visualization.DataTable();

            // Adding columns for the geo chart
            data.addColumn('string', 'Location');
            data.addColumn('number', 'Precipitation');

            // Adding rows from the CSV data
            pluvial.forEach((row, index) => {
                if (index > 0) { // Assuming the first row is headers
                    data.addRow([`${row[1]}, ${row[2]}`, parseFloat(row[9])]); // Using latitude and longitude as location, and column 10 as precipitation
                }
            });

            // Set chart options
            var options = {
                'title': 'Precipitation Data Representation',
                'width': 600,
                'height': 400
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
</head>

<body>
<!--Div that will hold the geo chart-->
<div id="chart_div"></div>
</body>
</html>