<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/data.js"></script>
    <script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/dashboards/datagrid.js"></script>
    <script src="https://code.highcharts.com/modules/geoheatmap.js"></script>

</head>
<body>


<h1>Einführung</h1>
<p>Lorem Ipsum....</p>

<div id="pluvial-floods-line-chart"></div>
<script>

    (async () => {


        const data = []

        const response = await fetch('http://localhost:8000/flooding_events_ch_precipation_yearly.csv')
        const text = await response.text()
        const rows = text.split('\n')

        rows.forEach(row => {
            const columns = row.split(',')

            data.push({
                year: parseInt(columns[1]),
                precipation: parseInt(columns[2]),
                floods: parseInt(columns[3]),
            })
        })


        Highcharts.chart('pluvial-floods-line-chart', {
            chart: {
                type: 'line'
            },
            title: {
                text: 'Precipitation Data Representation'
            },
            plotOptions: {
                line: {
                    dataLabels: {
                        enabled: true
                    },
                    enableMouseTracking: false
                }
            },
            yAxis: {
                title: {
                    text: 'Floods'
                },
                type: 'logarithmic',
            },
            xAxis: {
                title: {
                    text: 'Year'
                },
                min: 1979,
            },

            series: [{
                name: 'Floods',
                data: data.map(d => [d.year, d.floods])
            }, {
                name: 'Precipitation',
                data: data.map(d => [d.year, d.precipation])
            }]
        });

    })();
</script>


<div id="precipation-global-temp"></div>
<script>
    (async () => {
        Highcharts.chart('precipation-global-temp', {
            chart: {
                type: 'heatmap',
                inverted: true
            },

            accessibility: {
                description: 'We see how temperatures are warmer during the day, especially from around 9am to 9pm. May 8th through 11th are also overall colder days compared to the rest. Overall the temperatures range from around -1 degrees C to around 23 degrees C.'
            },

            data: {
                csvURL: 'http://localhost:8000/precipation_monthly_sum_with_global_mean_temp.csv',
            },

            title: {
                text: 'Highcharts heat map',
                align: 'left'
            },

            subtitle: {
                text: 'Temperature variation by day and hour through May 2017',
                align: 'left'
            },

            xAxis: {
                tickPixelInterval: 50,
                min: Date.UTC(2017, 4, 1),
                max: Date.UTC(2017, 4, 30)
            },

            yAxis: {
                accessibility: {
                    description: 'Hours in the day'
                },
                title: {
                    text: null
                },
                labels: {
                    format: '{value}:00'
                },
                lineWidth: 1,
                minPadding: 0,
                maxPadding: 0,
                startOnTick: false,
                endOnTick: false,
                tickPositions: [0, 6, 12, 18, 24],
                tickWidth: 1,
                min: 0,
                max: 23
            },

            colorAxis: {
                stops: [
                    [0, '#3060cf'],
                    [0.5, '#fffbbc'],
                    [0.9, '#c4463a']
                ],
                min: -5
            },

            series: [{
                borderWidth: 0,
                colsize: 24 * 36e5, // one day
                tooltip: {
                    headerFormat: 'Temperature<br/>',
                    pointFormat: '{point.x:%e %b, %Y} {point.y}:00: <b>{point.value} ℃</b>'
                },
                accessibility: {
                    enabled: false
                }
            }]
        });
    })();


    /*
    (async () => {


        const data = []

        const response = await fetch('http://localhost:8000/precipation_monthly_sum_with_global_mean_temp.csv')
        const text = await response.text()
        const rows = text.split('\n')

        rows.forEach(row => {
            const columns = row.split(',')
            if (columns[1] === '197901') {

                data.push({
                    geometry: {
                        type: 'Point',
                        coordinates: [parseFloat(columns[4]), parseFloat(columns[3])]
                    },
                    lat: parseFloat(columns[3]),
                    lon: parseFloat(columns[4]),
                    value: parseInt(columns[5]),
                })
            }
        })

        console.log(data)

        const topology = await fetch(
            // get map for switzerland
            'https://code.highcharts.com/mapdata/countries/ch/ch-all.topo.json'
        ).then(response => response.json());


        Highcharts.mapChart('precipation-global-temp', {
            chart: {
                map: topology
            },

            colorAxis: {
                min: 0,
                max: 200
            },
            mapNavigation: {
                enabled: true,
                buttonOptions: {
                    verticalAlign: 'bottom'
                }
            },

            series: [{
                name: 'Switzerland',
                borderColor: 'rgba(0, 0, 0, 0.4)',
                states: {
                    inactive: {
                        enabled: false
                    }
                },
                accessibility: {
                    exposeAsGroupOnly: true
                }
            }, {
                type: 'geoheatmap',
                data: data,
                colsize: 0.5,
                rowsize: 0.5,
                interpolation: {
                    enabled: true,
                    blur: 1
                },
            }]
        })
        ;

    })();

     */
</script>

</body>
</html>